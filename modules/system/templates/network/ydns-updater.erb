#!/bin/sh

auth="<%= @username %>:<%= @password %>"
hostname="<%= @hostname %>.<%= @domain %>"

target=8.8.8.8
ip=$(ip route get $target | sed -ne '/^unreachable/d' -e 's/.* src \([^ ]*\).*/\1/p')
[ -n "$ip" ] || return
curl -s "https://${auth}@ydns.eu/api/v1/update/?host=${hostname}&ip=${ip}" > /dev/null
